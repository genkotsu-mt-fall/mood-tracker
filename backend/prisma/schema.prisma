// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String  @id @default(uuid()) @db.Uuid
  email          String  @unique
  name           String?
  hashedPassword String
  posts          Post[]

  /// ã“ã®ãƒ¦ãƒ¼ã‚¶ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ä»–ã®ãƒ¦ãƒ¼ã‚¶ã¨ã®é–¢ä¿‚
  /// await prisma.user.findUnique({
  ///   where: { id: userId },
  ///   include: {
  ///     following: {
  ///       include: { followee: true } //ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼å´ã®ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—
  ///     }
  ///   }
  ///})
  following Follow[] @relation("UserFollowing")

  /// ã“ã®ãƒ¦ãƒ¼ã‚¶ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ä»–ã®ãƒ¦ãƒ¼ã‚¶ã¨ã®é–¢ä¿‚
  /// await prisma.user.findUnique({
  ///   where: { id: userId },
  ///   include: {
  ///     followers: {
  ///       include: { follower: true } //ãƒ•ã‚©ãƒ­ãƒ¼å…ˆã®ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’å–å¾—
  ///     }
  ///   }
  ///})
  followers Follow[] @relation("UserFollowers")

  groups       Group[]
  groupMembers GroupMember[]
}

model Follow {
  id String @id @default(uuid()) @db.Uuid

  /// ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹å´ã®ãƒ¦ãƒ¼ã‚¶IDï¼ˆè‡ªåˆ†ï¼‰
  follower_id String @db.Uuid
  follower    User   @relation("UserFollowing", fields: [follower_id], references: [id])

  /// ãƒ•ã‚©ãƒ­ãƒ¼ã•ã‚Œã‚‹å´ã®ãƒ¦ãƒ¼ã‚¶IDï¼ˆç›¸æ‰‹ï¼‰
  followee_id String @db.Uuid
  followee    User   @relation("UserFollowers", fields: [followee_id], references: [id])

  /// ãƒ•ã‚©ãƒ­ãƒ¼ã—ãŸæ—¥æ™‚
  followed_at DateTime @default(now())

  @@unique([follower_id, followee_id])
}

model Group {
  id         String   @id @default(uuid()) @db.Uuid
  name       String
  created_at DateTime @default(now())

  /// ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ã®ID(=ã‚°ãƒ«ãƒ¼ãƒ—ã®æ‰€æœ‰è€…)
  user_id String @db.Uuid
  user    User   @relation(fields: [user_id], references: [id])

  /// ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«æ‰€å±ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãŸã¡ï¼ˆGroupMember çµŒç”±ï¼‰
  members GroupMember[]
}

model GroupMember {
  id String @id @default(uuid()) @db.Uuid

  /// ãƒ¡ãƒ³ãƒãƒ¼ãŒã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚ŒãŸæ—¥æ™‚
  added_at DateTime @default(now())

  /// æ‰€å±ã—ã¦ã„ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã®ID
  group_id String @db.Uuid
  group    Group  @relation(fields: [group_id], references: [id])

  /// æ‰€å±ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ã®IDï¼ˆï¼ãƒ¡ãƒ³ãƒãƒ¼IDï¼‰
  member_id String @db.Uuid
  member    User   @relation(fields: [member_id], references: [id])

  @@unique([group_id, member_id])
}

model Post {
  id     String @id @default(uuid()) @db.Uuid
  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id])

  /// æ°—åˆ†ã‚’è¡¨ã™ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¾‹: "happy", "sad" ãªã©ï¼‰
  mood String?

  /// æ°—åˆ†ã®å¼·ã•ï¼ˆ1ã€œ10 ãªã©ã®æ•°å€¤ã‚¹ã‚³ã‚¢ï¼‰
  intensity Int?

  /// æŠ•ç¨¿æœ¬æ–‡
  body String

  /// æ°—åˆ†ã«å¯¾å¿œã™ã‚‹çµµæ–‡å­—ï¼ˆä¾‹: ğŸ˜Šï¼‰
  emoji String?

  /// ä½¿ç”¨ã•ã‚ŒãŸæŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ID
  templateId String? @db.Uuid

  /// å…¬é–‹è¨­å®šæƒ…å ±ï¼ˆãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼é™å®šãƒ»ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆãªã©ï¼‰ã‚’JSONå½¢å¼ã§ä¿æŒ
  privacyJson Json?

  /// ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼é™å®šã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
  followersOnly Boolean

  /// ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼é™å®šã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
  followBackOnly Boolean

  /// æŠ•ç¨¿é–²è¦§ã«å¿…è¦ãªæœ€å°ãƒ•ã‚©ãƒ­ãƒ¼æ—¥æ•°
  minFollowDays Int?

  /// æŠ•ç¨¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹çµ‚äº†æ—¥æ™‚ï¼ˆæŒ‡å®šãŒã‚ã‚Œã°æ™‚é™å…¬é–‹ï¼‰
  visibleUntil DateTime?

  /// æŠ•ç¨¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹é–‹å§‹æ—¥æ™‚ï¼ˆäºˆç´„æŠ•ç¨¿æ©Ÿèƒ½ï¼‰
  visibleAfter DateTime?

  /// ç·Šæ€¥ãƒ•ãƒ©ã‚°ï¼ˆè‡ªå‚·ç­‰ã®å…†å€™ãŒã‚ã‚‹ãªã©æ³¨æ„ã‚’è¦ã™ã‚‹å ´åˆã«trueï¼‰
  crisisFlag Boolean

  /// æŠ•ç¨¿ä½œæˆæ—¥æ™‚ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç¾åœ¨æ™‚åˆ»ï¼‰
  createdAt DateTime @default(now())

  /// æŠ•ç¨¿æ›´æ–°æ—¥æ™‚
  updatedAt DateTime @updatedAt
}
